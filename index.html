<!doctype html>
<html>
  <head>
    <h3>Welcome Prolific Participant</h3>
  </head>
  <body>
    <script>
      const params = new URLSearchParams(window.location.search);
      const prolific_id = params.get("PROLIFIC_PID");
      const study_id = params.get("STUDY_ID");
      const session_id = params.get("SESSION_ID");

      // function hashString(str) {
      //   let has = 5381;
      //   for (let i = 0; i < str.length; i++) {
      //     hash = (hash << 5) + hash + str.charCodeAt(i);
      //     hash = hash & 0xffffffff;
      //   }
      //   return Math.abs(hash);
      // }
      //
      // function generateCode(prolific_id) {
      //   const hash = hashString(prolific_id);
      //   const code = (hash % 900000) + 100000;
      //   return code;
      // }

      function redirect() {
        const input = document.getElementById("finishCode").value.trim();
        if (input !== "C191Z2IJ" && input !== "C7RDH5T5") {
          alert("Please enter a Valid Code.");
          return;
        } else if (input === "C191Z2IJ") {
          const redirectUrl =
            "https://app.prolific.com/submissions/complete?cc=C191Z2IJ";
          window.location.href = redirectUrl;
        } else {
          const redirectUrl =
            "https://app.prolific.com/submissions/complete?cc=C7RDH5T5";
          window.location.href = redirectUrl;
        }
      }

      const output = document.getElementById("result");
      if (prolific_id) {
        //const code = generateCode(prolific_id);
        output.innerText = `your Prolific PID = ${prolific_id}.`;
      } else {
        output.innerText = `No Prolific PID found in URL.`;
      }
    </script>

    <!-- <p id="result">Loading ...</p> -->
    <p>
      In this experiment, we would like to get the IMU sensor data, including
      accelerometer and gyroscope data, from VR headsets in three scenarios:
      Stable on the Table, Sitting Still, and Standing Still.
    </p>
    <p>
      ** You are expected to have one of Meta Quest 2 or Meta Quest 3S. Any
      other types of VR headsets are not supported.
    </p>
    <p>
      ** Each device is allowed to participate only once. Multiple attempts will
      result in rejection.
    </p>
    <br />
    <h3>Preparation</h3>
    <ol>
      <li>Connect your VR headset to Wi-Fi.</li>
      <!--<li>Please make sure your device's volume is set to the maximum.</li>-->
      <li>
        Set the Display-off time to 15 minutes. (Library -> Settings -> General
        -> Power -> Display off)
      </li>
      <li>
        Enable the Developer Mode of your headset using the Meta Horizon app on
        your smartphone (Meta Horizon app -> Device (Upper left corner) ->
        Headset Settings -> Developer Mode)
      </li>
      <li>
        In the Meta Horizon Store, search and install the Mobile VR Station.
      </li>
      <li>
        In Library, locate Mobile VR Station, select "three dots" at the upper
        right corner -> Settings -> Release channels. Please select Old Oculus
        Versions -> Confirm. Then uninstall and reinstall Mobile VR Station.
      </li>
      <li>
        Once reinstalled, select "three dots" -> Settings -> Enable "Storage",
        "Photos and videos", "Music and audio" -> In Manage Storage -> Manage ->
        Allow access.
      </li>
      <li>
        In your VR headset, download the APK:
        <a
          href="https://drive.google.com/file/d/1n8Uw99iMNAn3kQSkUUBFqCEWpEycl6yW/view?usp=sharing"
          >AndroidSensorLog.apk</a
        >
      </li>
      <li>
        Open Mobile VR Station -> Allow Permissions (if any) -> Click continue
        at the bottom -> Local Files -> All Folders -> Android -> data -> Scoped
        Storage Actions -> Request access -> Select "Downloads" -> Find
        "AndroidSensorLog.apk" -> Press "expand" icon at the upper right corner
        -> Install
      </li>
      <li>
        Open “AndroidSensorLog” from the Mobile VR Station on your headset.
      </li>
      <li>
        Before starting the assignments, please select your device type and
        enter your Prolific ID in the VR application.
      </li>
      <li>
        (Quest 2 users only) Before starting Task 1, prepare a small opaque
        paper piece and tape, then cover the
        <strong>Proximity sensor</strong> located between the left and right
        lenses. This prevents the headset from auto sleeping during the
        experiment.
      </li>
    </ol>
    <p>
      ** Failure to enter a valid Prolific ID will result in rejection. Failure
      to cover the proximity sensor will result in rejection.
    </p>
    <br />
    <p>There are 3 tasks for you:</p>
    <strong>Task 1: Stable on the Table</strong>
    <ol>
      <li>
        Please make sure your device is on a separate table without any laptops,
        speakers, or anything else that could cause vibrations.
      </li>

      <li>Put on your headset.</li>
      <li>
        Press <strong>Start Task1</strong> in the application, take off your
        headset, and put it on the table.
      </li>
      <li>
        Wait for at least 5 minutes, put on your headset, select
        <strong>Stop and Upload</strong>, and wait for
        <code>Upload Successful.</code> to show at the bottom of the screen.
      </li>
    </ol>
    <p>
      ** Failure to upload a valid data file collected for at least 5 minutes
      will result in rejection.
    </p>
    <br />
    <strong>Task 2: Sitting Still</strong>
    <ol>
      <li>Put on your headset.</li>
      <li>
        Press <strong>Start Task2</strong> in the application and SIT STILL
        wherever you feel comfortable. Try to stay still as much as you can.
      </li>
      <li>
        Wait for at least 5 minutes, select <strong>Stop and Upload</strong>,
        and wait for <code>Upload Successful.</code> to show at the bottom of
        the screen.
      </li>
    </ol>
    <p>
      ** Failure to upload a valid data file collected for at least 5 minutes
      will result in rejection.
    </p>
    <br />
    <strong>Task 3: Standing Still</strong>
    <ol>
      <li>Put on your headset.</li>
      <li>
        Press <strong>Start Task3</strong> in the application and STAND STILL.
        Try to stay still as much as you can.
      </li>
      <li>
        Wait for at least 5 minutes, select <strong>Stop and Upload</strong>,
        and wait for <code>Upload Successful.</code> to show at the bottom of
        the screen.
      </li>
    </ol>
    <p>
      ** Failure to upload a valid data file collected for at least 5 minutes
      will result in rejection.
    </p>
    <br />
    <p>
      When you finish all the tasks, a <strong>Confirmation Code</strong> is
      generated in your VR application. Please enter the code below.
    </p>
    <p>** Failure to provide the code will result in rejection.</p>
    <p>
      If you have any questions or suggestions, please contact
      <a href="mailto:yi.qu@temple.edu">yi.qu@temple.edu</a>. Thanks.
    </p>
    <input type="text" id="finishCode" placeholder="Please enter the code" />

    <p>
      <strong
        >Thanks for your participation. Please click the submit button.</strong
      >
    </p>
    <button id="gotoButton" onClick="redirect()">Submit</button>
  </body>
</html>

<!---
    <strong>Please enter your email address and your device type here below.</strong>
    <div>
        <p><strong>Email address:</strong></p>
        <crowd-input name="email" default-value=${task.input.email} placeholder="e.g. example@email.com" type="email" required></crowd-input>
    </div>

    <div>
        <p><strong>Device Type:</strong></p>
        <crowd-input name="deviceType" default-value=${task.input.deviceType} placeholder="Meta Quest 2, Meta Quest 3, or Meta Quest 3s" required></crowd-input>
    </div>
    --->
